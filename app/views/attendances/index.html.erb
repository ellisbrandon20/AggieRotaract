<!--<= javascript_include_tag "events" %>-->

<h1 class="title">Upcoming Events</h1>

<% if @user_upcoming_events.nil? %>
    <div> You are not signed up for any events. </div>
<% else %>
    <% @user_upcoming_events.each do |event| %>
        <div class="event-card">
            <div class="row">
                <div class="col-sm-9">
                    <div class="row col-sm-12">
                        <h3 id="event_title"><%= event[:active_record].name %></h3>
                    </div>
                    <div class="row col-sm-12">
                        <b>Time: </b>
                        <div class="event-item-margin">
                            <%= event[:active_record].start_time.strftime("%I:%M %p")%>
                            -
                            <%= event[:active_record].end_time.strftime("%I:%M %p") %>
                        </div>
                    </div>
                    <div class="row col-sm-12">
                        <b>Date: </b>
                        <div class="event-item-margin">
                            <%= event[:active_record].date.strftime("%B %d, %Y") %>
                            <%= event[:wait_list_pos] %>
                        </div>
                    </div>
                    <div class="row col-sm-12">
                        <b>Contact: </b>
                        <div class="event-item-margin">
                            <%= event[:active_record].contact %>
                        </div>
                    </div>
                    <b>Description: </b>
                    <div class="row col-sm-12">
                        <%= event[:active_record].description %>
                    </div>
                </div>
                
                <div class="col-sm-3">
                    <div class="row col-sm-12">
                        Points: 
                        <%= event[:active_record].max_points %>
                    </div>
                    <div class="row col-sm-12">
                        Spots Remaining: 12
                        <!--<%= event[:active_record].capacity %>-->
                    </div>
                    <div class="row col-sm-12 event-image">
                        <%= image_tag(event[:active_record].image, class: "img-thumbnail") %>
                    </div>
                    <div class="row col-sm-12">
                        <a href="" id="address" class="address" target="_blank"><%= event[:active_record].address %></a>
                    </div>
                    <div class="row col-sm-12">
                         <!--if admin -->
                        <% if session[:admin] %>
                            <div class="row col-sm-12">
                                <div class="col-xs-6 event-btn">
                                    <button type="button" class="btn btn-default btn-block">Edit</button>
                                </div>
                                <div class="col-xs-6 event-btn">
                                    <button type="button" class="btn btn-danger btn-block">Delete</button>
                                </div>
                            </div>
                            <div class="row col-xs-12 event-btn">
                                    <button type="button" class="btn btn-default btn-block">View Sign Ups</button>
                            </div>
                        
                        <!-- general user -->    
                        <% else %>
                         <!--Check to see if member is signed up. Show 'signup' button if not signed up and 'remove me' button otherwise-->
                            <div class="col-sm-12 event-btn">
                                <button type="button" class="btn btn-success btn-block">Sign Up</button>
                            </div>
                        <% end %>
                        <!-- end --> 
                    </div>
                </div>
            </div>
        </div>
        <br>
    <% end %>
<% end %>
<script>
// couldnt get the script to run from any of the coffee files 
$(document).ready(function(){
    var $editItem, $elements, $link, $pluslink, i;
    $elements = document.getElementsByClassName('address');
    i = 0;
    while (i < $elements.length) {
        $editItem = $elements[i];
        $link = $editItem.text;
        $pluslink = $link.replace(/\s+/g, '+');
        $elements[i].href = 'https://www.google.com/maps?q=' + $pluslink;
        $elements[i].text = 'Google Maps Link';
        i++;
    }
});
</script>